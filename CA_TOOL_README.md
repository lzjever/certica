# CAè¯ä¹¦ç”Ÿæˆå·¥å…·

ä¸€ä¸ªç®€å•æ˜“ç”¨çš„CAè¯ä¹¦ç”Ÿæˆå·¥å…·ï¼Œç”¨äºŽæœ¬åœ°å¼€å‘å’Œæµ‹è¯•ã€‚

## åŠŸèƒ½ç‰¹æ€§

1. **åˆ›å»ºæ ¹CAè¯ä¹¦** - ç”Ÿæˆè‡ªç­¾åæ ¹è¯ä¹¦å’Œç§é’¥
2. **ç­¾å‘è¯ä¹¦** - æ”¯æŒæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯è¯ä¹¦ç­¾å‘ï¼Œå¯é…ç½®DNSåç§°ã€IPåœ°å€ç­‰
3. **æ¨¡æ¿æ”¯æŒ** - ä½¿ç”¨æ¨¡æ¿æ–‡ä»¶ä¿å­˜å¸¸ç”¨é…ç½®ï¼Œå‡å°‘é‡å¤è¾“å…¥
4. **äº¤äº’å¼ç•Œé¢** - æä¾›å‹å¥½çš„ç»ˆç«¯å›¾å½¢ç•Œé¢ï¼ˆä½¿ç”¨Richåº“ï¼Œæ”¯æŒemojiå›¾æ ‡ï¼‰
5. **å‘½ä»¤è¡ŒæŽ¥å£** - æ”¯æŒå®Œæ•´çš„å‘½ä»¤è¡Œæ“ä½œ
6. **ç³»ç»Ÿé›†æˆ** - å¯ä»¥å°†CAè¯ä¹¦å®‰è£…åˆ°ç³»ç»Ÿä¿¡ä»»å­˜å‚¨ï¼Œæˆ–ä»Žç³»ç»Ÿä¸­ç§»é™¤
7. **æ™ºèƒ½ç›®å½•ç»„ç»‡** - è¯ä¹¦æŒ‰CAè‡ªåŠ¨åˆ†ç±»å­˜å‚¨ï¼Œæ¸…æ™°æ˜“ç®¡ç†
8. **è·¯å¾„ç®€åŒ–æ˜¾ç¤º** - è‡ªåŠ¨åŽ»æŽ‰å†—é•¿çš„è·¯å¾„å‰ç¼€ï¼Œæ˜¾ç¤ºæ›´ç®€æ´

## å®‰è£…

```bash
# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# æˆ–è€…ç›´æŽ¥å®‰è£…
pip install click rich
```

## ä½¿ç”¨æ–¹æ³•

### äº¤äº’å¼ç•Œé¢ï¼ˆæŽ¨èï¼‰

ç›´æŽ¥è¿è¡Œè„šæœ¬ï¼ˆä¸å¸¦å‚æ•°ï¼‰è¿›å…¥äº¤äº’å¼ç•Œé¢ï¼š

```bash
certica
```

äº¤äº’å¼ç•Œé¢æä¾›ï¼š
- ðŸŽ¨ ç¾Žè§‚çš„å›¾å½¢ç•Œé¢ï¼ˆä½¿ç”¨Richåº“ï¼‰
- ðŸ”’ æ¸…æ™°çš„èœå•é€‰é¡¹ï¼ˆå¸¦emojiå›¾æ ‡ï¼‰
- ðŸ“‹ æ ¼å¼åŒ–çš„è¡¨æ ¼æ˜¾ç¤º
- ðŸ–¥ï¸ è‡ªåŠ¨è¯†åˆ«è¯ä¹¦ç±»åž‹ï¼ˆæœåŠ¡å™¨/å®¢æˆ·ç«¯ï¼‰
- ðŸ“‘ æŒ‰CAç­›é€‰è¯ä¹¦åˆ—è¡¨

### å‘½ä»¤è¡Œæ¨¡å¼

#### åˆ›å»ºæ ¹CAè¯ä¹¦

```bash
# ä½¿ç”¨é»˜è®¤å€¼
certica create-ca

# è‡ªå®šä¹‰å‚æ•°
certica create-ca --name myca --org "My Company" --validity 3650

# ä½¿ç”¨æ¨¡æ¿
certica create-ca --template default
```

#### ç­¾å‘è¯ä¹¦

```bash
# ç­¾å‘æœåŠ¡å™¨è¯ä¹¦
certica sign --ca myca --name nginx-server --type server \
    --dns localhost --dns example.com --ip 127.0.0.1

# ç­¾å‘å®¢æˆ·ç«¯è¯ä¹¦
certica sign --ca myca --name client1 --type client

# ä½¿ç”¨æ¨¡æ¿
certica sign --ca myca --name etcd-server --type server \
    --template etcd --dns etcd.local --ip 10.0.0.1
```

#### åˆ—å‡ºCAå’Œè¯ä¹¦

```bash
# åˆ—å‡ºæ‰€æœ‰CA
certica list-cas

# åˆ—å‡ºæ‰€æœ‰å·²ç­¾å‘çš„è¯ä¹¦
certica list-certs

# åˆ—å‡ºç‰¹å®šCAç­¾å‘çš„è¯ä¹¦
certica list-certs --ca myca
```

#### æ¨¡æ¿ç®¡ç†

```bash
# åˆ›å»ºæ¨¡æ¿
certica create-template --name mytemplate --org "My Org"

# åˆ—å‡ºæ¨¡æ¿
certica list-templates
```

#### ç³»ç»Ÿè¯ä¹¦ç®¡ç†

```bash
# å®‰è£…CAåˆ°ç³»ç»Ÿï¼ˆéœ€è¦sudoæƒé™ï¼‰
sudo certica install --ca myca

# ä»Žç³»ç»Ÿç§»é™¤CAï¼ˆéœ€è¦sudoæƒé™ï¼‰
sudo certica remove --ca myca
```

#### æŸ¥çœ‹è¯ä¹¦ä¿¡æ¯

```bash
certica info --cert output/certs/myca/nginx-server/cert.pem
```

## æ–‡ä»¶ç»“æž„

æ‰€æœ‰ç”Ÿæˆçš„æ–‡ä»¶éƒ½ä¿å­˜åœ¨ `output/` ç›®å½•ä¸‹ï¼Œ**æŒ‰CAè‡ªåŠ¨ç»„ç»‡**ï¼š

```
output/
â”œâ”€â”€ ca/                          # æ ¹CAè¯ä¹¦ç›®å½•
â”‚   â””â”€â”€ {ca_name}/               # æ¯ä¸ªCAæœ‰è‡ªå·±çš„ç›®å½•
â”‚       â”œâ”€â”€ {ca_name}.key.pem    # CAç§é’¥
â”‚       â””â”€â”€ {ca_name}.cert.pem   # CAè¯ä¹¦
â”œâ”€â”€ certs/                       # ç­¾å‘çš„è¯ä¹¦ç›®å½•
â”‚   â””â”€â”€ {ca_name}/               # æŒ‰CAåç§°ç»„ç»‡
â”‚       â””â”€â”€ {cert_name}/         # æ¯ä¸ªè¯ä¹¦æœ‰è‡ªå·±çš„ç›®å½•
â”‚           â”œâ”€â”€ key.pem          # è¯ä¹¦ç§é’¥
â”‚           â””â”€â”€ cert.pem         # è¯ä¹¦
â””â”€â”€ templates/                   # æ¨¡æ¿æ–‡ä»¶ç›®å½•
    â”œâ”€â”€ default.json
    â”œâ”€â”€ etcd.json
    â””â”€â”€ nginx.json
```

### ç›®å½•ç»„ç»‡ä¼˜åŠ¿

- âœ… **æ¸…æ™°åˆ†ç¦»**ï¼šä¸åŒCAç­¾å‘çš„è¯ä¹¦è‡ªåŠ¨åˆ†å¼€å­˜å‚¨
- âœ… **æ˜“äºŽæŸ¥æ‰¾**ï¼šä»Žç›®å½•ç»“æž„å°±èƒ½çœ‹å‡ºè¯ä¹¦çš„å½’å±žå…³ç³»
- âœ… **ä¾¿äºŽç®¡ç†**ï¼šå¯ä»¥è½»æ¾åˆ é™¤æŸä¸ªCAåŠå…¶æ‰€æœ‰è¯ä¹¦
- âœ… **è·¯å¾„ç®€æ´**ï¼šæ˜¾ç¤ºæ—¶è‡ªåŠ¨åŽ»æŽ‰ `output/` å‰ç¼€

### ç¤ºä¾‹ç›®å½•ç»“æž„

```
output/
â”œâ”€â”€ ca/
â”‚   â”œâ”€â”€ myca/
â”‚   â”‚   â”œâ”€â”€ myca.key.pem
â”‚   â”‚   â””â”€â”€ myca.cert.pem
â”‚   â””â”€â”€ etcd-ca/
â”‚       â”œâ”€â”€ etcd-ca.key.pem
â”‚       â””â”€â”€ etcd-ca.cert.pem
â””â”€â”€ certs/
    â”œâ”€â”€ myca/                    # mycaç­¾å‘çš„è¯ä¹¦
    â”‚   â”œâ”€â”€ nginx-server/
    â”‚   â”‚   â”œâ”€â”€ key.pem
    â”‚   â”‚   â””â”€â”€ cert.pem
    â”‚   â””â”€â”€ client1/
    â”‚       â”œâ”€â”€ key.pem
    â”‚       â””â”€â”€ cert.pem
    â””â”€â”€ etcd-ca/                 # etcd-caç­¾å‘çš„è¯ä¹¦
        â”œâ”€â”€ etcd-server/
        â”‚   â”œâ”€â”€ key.pem
        â”‚   â””â”€â”€ cert.pem
        â””â”€â”€ etcd-client/
            â”œâ”€â”€ key.pem
            â””â”€â”€ cert.pem
```

## æ¨¡æ¿æ–‡ä»¶æ ¼å¼

æ¨¡æ¿æ–‡ä»¶æ˜¯JSONæ ¼å¼ï¼ŒåŒ…å«é»˜è®¤å€¼ï¼š

```json
{
  "organization": "Development",
  "country": "CN",
  "state": "Beijing",
  "city": "Beijing",
  "default_validity_days": 365,
  "default_key_size": 2048
}
```

## ä½¿ç”¨ç¤ºä¾‹

### ä¸ºNginxåˆ›å»ºè¯ä¹¦

```bash
# 1. åˆ›å»ºæ ¹CA
certica create-ca --name nginx-ca

# 2. ç­¾å‘æœåŠ¡å™¨è¯ä¹¦
certica sign --ca nginx-ca --name nginx \
    --type server --dns localhost --dns example.com --ip 127.0.0.1

# 3. å®‰è£…CAåˆ°ç³»ç»Ÿï¼ˆå¯é€‰ï¼Œè¿™æ ·æµè§ˆå™¨ä¸ä¼šæŠ¥é”™ï¼‰
sudo certica install --ca nginx-ca

# 4. åœ¨nginxé…ç½®ä¸­ä½¿ç”¨
# ssl_certificate output/certs/nginx-ca/nginx/cert.pem;
# ssl_certificate_key output/certs/nginx-ca/nginx/key.pem;
```

### ä¸ºetcdåˆ›å»ºè¯ä¹¦

```bash
# 1. åˆ›å»ºæ ¹CA
certica create-ca --name etcd-ca

# 2. ç­¾å‘æœåŠ¡å™¨è¯ä¹¦
certica sign --ca etcd-ca --name etcd-server \
    --type server --dns etcd.local --dns etcd-0.etcd.local \
    --ip 10.0.0.1 --ip 10.0.0.2

# 3. ç­¾å‘å®¢æˆ·ç«¯è¯ä¹¦
certica sign --ca etcd-ca --name etcd-client --type client
```

### ä½¿ç”¨äº¤äº’å¼ç•Œé¢

```bash
# å¯åŠ¨äº¤äº’å¼ç•Œé¢
certica

# ç„¶åŽæŒ‰ç…§èœå•æç¤ºæ“ä½œï¼š
# 1. é€‰æ‹© "1" åˆ›å»ºæ ¹CAè¯ä¹¦
# 2. é€‰æ‹© "2" ç­¾å‘è¯ä¹¦ï¼ˆä¼šå…ˆè®©ä½ é€‰æ‹©CAï¼‰
# 3. é€‰æ‹© "3" åˆ—å‡ºæ‰€æœ‰CAè¯ä¹¦
# 4. é€‰æ‹© "4" åˆ—å‡ºå·²ç­¾å‘çš„è¯ä¹¦ï¼ˆä¼šå…ˆè®©ä½ é€‰æ‹©CAï¼‰
# 5. é€‰æ‹© "5" ç®¡ç†æ¨¡æ¿æ–‡ä»¶
# 6. é€‰æ‹© "6" å®‰è£…CAè¯ä¹¦åˆ°ç³»ç»Ÿ
# 7. é€‰æ‹© "7" ä»Žç³»ç»Ÿç§»é™¤CAè¯ä¹¦
# 0. é€‰æ‹© "0" é€€å‡º
```

## è·¯å¾„æ˜¾ç¤ºè¯´æ˜Ž

å·¥å…·ä¼šè‡ªåŠ¨ç®€åŒ–è·¯å¾„æ˜¾ç¤ºï¼ŒåŽ»æŽ‰ `output/` å‰ç¼€ï¼Œä½¿è¾“å‡ºæ›´ç®€æ´ï¼š

**å®žé™…å­˜å‚¨è·¯å¾„ï¼š**
```
/home/user/project/output/ca/myca/myca.key.pem
```

**æ˜¾ç¤ºè·¯å¾„ï¼š**
```
ca/myca/myca.key.pem
```

è¿™æ ·æ—¢ä¿æŒäº†è·¯å¾„çš„å®Œæ•´æ€§ï¼Œåˆè®©æ˜¾ç¤ºæ›´åŠ ç®€æ´æ˜“è¯»ã€‚

## æ³¨æ„äº‹é¡¹

1. è¿™æ˜¯ä¸€ä¸ª**æœ¬åœ°å¼€å‘å·¥å…·**ï¼Œä¸è€ƒè™‘å®‰å…¨æ€§ï¼Œä»…ç”¨äºŽæµ‹è¯•
2. æ‰€æœ‰æ–‡ä»¶ä¿å­˜åœ¨å½“å‰ç›®å½•çš„ `output/` ç›®å½•ï¼Œå¯ä»¥æ‰“åŒ…æ•´ä¸ªç›®å½•åˆ°å…¶ä»–åœ°æ–¹ä½¿ç”¨
3. ç³»ç»Ÿè¯ä¹¦å®‰è£…/ç§»é™¤éœ€è¦sudoæƒé™ï¼ˆLinux/macOSï¼‰
4. å·¥å…·ä¼šè‡ªåŠ¨åˆ›å»ºå¿…è¦çš„ç›®å½•ç»“æž„
5. è¯ä¹¦æŒ‰CAè‡ªåŠ¨åˆ†ç±»å­˜å‚¨ï¼Œä¸åŒCAçš„è¯ä¹¦ä¸ä¼šæ··æ·†

## å¸¸è§é—®é¢˜

**Q: å¦‚ä½•å°†æ•´ä¸ªå·¥å…·æ‰“åŒ…åˆ°å…¶ä»–æœºå™¨ï¼Ÿ**

A: ç›´æŽ¥æ‰“åŒ…æ•´ä¸ªç›®å½•ï¼ŒåŒ…æ‹¬ `output/` ç›®å½•ï¼Œæ‰€æœ‰æ•°æ®éƒ½åœ¨é‡Œé¢ã€‚ç›®å½•ç»“æž„ä¼šè‡ªåŠ¨ä¿æŒã€‚

**Q: å¦‚ä½•åˆ é™¤å·²åˆ›å»ºçš„CAæˆ–è¯ä¹¦ï¼Ÿ**

A: ç›´æŽ¥åˆ é™¤ `output/ca/{ca_name}/` ç›®å½•åˆ é™¤CAï¼Œåˆ é™¤ `output/certs/{ca_name}/` ç›®å½•åˆ é™¤è¯¥CAçš„æ‰€æœ‰è¯ä¹¦ã€‚

**Q: è¯ä¹¦å®‰è£…å¤±è´¥æ€Žä¹ˆåŠžï¼Ÿ**

A: ç¡®ä¿æœ‰sudoæƒé™ï¼Œå¹¶ä¸”ç³»ç»Ÿæ”¯æŒç›¸åº”çš„è¯ä¹¦ç®¡ç†å‘½ä»¤ï¼ˆupdate-ca-certificates æˆ– update-ca-trustï¼‰ã€‚

**Q: ä¸ºä»€ä¹ˆè¯ä¹¦åˆ—è¡¨æ˜¾ç¤ºæ—¶å…ˆè¦é€‰æ‹©CAï¼Ÿ**

A: è¿™æ ·å¯ä»¥æŒ‰CAç­›é€‰è¯ä¹¦ï¼Œæ›´æ¸…æ™°åœ°æŸ¥çœ‹æ¯ä¸ªCAç­¾å‘äº†å“ªäº›è¯ä¹¦ã€‚ä½¿ç”¨å‘½ä»¤è¡Œæ—¶å¯ä»¥ç”¨ `--ca` å‚æ•°ç›´æŽ¥æŒ‡å®šã€‚

**Q: è·¯å¾„æ˜¾ç¤ºä¸ºä»€ä¹ˆåŽ»æŽ‰äº†outputå‰ç¼€ï¼Ÿ**

A: ä¸ºäº†æ˜¾ç¤ºæ›´ç®€æ´ã€‚`output/` æ˜¯å›ºå®šçš„ä¿å­˜ç›®å½•ï¼ŒåŽ»æŽ‰åŽè·¯å¾„æ›´çŸ­æ›´æ˜“è¯»ã€‚å®žé™…æ–‡ä»¶è·¯å¾„ä»ç„¶æ˜¯å®Œæ•´çš„ã€‚

## ç‰ˆæœ¬ä¿¡æ¯

- ç‰ˆæœ¬: 1.0.0
- Python: 3.7+
- ä¾èµ–: click >= 8.0.0, rich >= 13.0.0
